(()=>{"use strict";var t,e,n=function(t,e,n){var o=e.querySelector(".".concat(n.id,"-input-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""},o=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.classList.remove(t.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(t.inactiveButtonClass),n.setAttribute("disabled","disabled"))},r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"905a05e8-b14e-4b96-9788-de898e8848e1","Content-Type":"application/json"}},c=document.querySelector(".profile__name"),u=document.querySelector(".profile__description"),i=document.querySelector(".profile__avatar"),a=document.querySelector("#post").content,s=document.querySelector(".posts-list"),l=function(e,n,o,r,c){var u=a.querySelector(".post").cloneNode(!0),i=u.querySelector(".post__button-like"),s=u.querySelector(".post__photo");if(u.id=r,u.querySelector(".post__title").textContent=e,o.some((function(e){return e._id===t}))&&i.classList.add("post__button-like_active"),_(u,o.length),i.addEventListener("click",d),c===t){var l=u.querySelector(".post__delete");l.classList.add("post__delete_active"),l.addEventListener("click",(function(t){N(y),H(t)}))}return s.src=n,s.alt=e,s.addEventListener("click",(function(t){z({src:t.target.src,alt:e,textContent:e})})),u},p=function(t,e){e.prepend(t)},d=function(t){var e,n=t.target.closest(".post"),o=t.target;o.classList.contains("post__button-like_active")?(e=n.id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){o.classList.remove("post__button-like_active"),_(n,t.likes.length)})):function(t){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(n.id).then((function(t){o.classList.add("post__button-like_active"),_(n,t.likes.length)}))},_=function(t,e){t.querySelector(".post__count-likes").textContent=e},f=document.querySelector(".popup_type_edit-profile"),m=document.querySelector(".popup_type_add-post"),v=document.querySelector(".popup_type_update-avatar"),y=document.querySelector(".popup_type_delete-card"),h=document.querySelector(".popup__input-field_type_name-profile"),S=document.querySelector(".popup__input-field_type_description-profile"),b=document.querySelector(".popup__input-field_type_name-mesto"),q=document.querySelector(".popup__input-field_type_url-link"),C=document.querySelector(".popup__input-field_type_avatar-url-link"),k=document.querySelector(".popup__form_type_edit-profile"),L=document.querySelector(".popup__form_type_add-post"),E=document.querySelector(".popup__form_type_update-avatar"),g=document.querySelector(".popup__form_type_delete-card"),x=k.querySelector(".popup__save-button"),j=L.querySelector(".popup__save-button"),A=E.querySelector(".popup__save-button"),P=g.querySelector(".popup__save-button"),w=document.querySelector(".popup-with-image"),U=document.querySelector(".popup-with-image__image"),B=document.querySelector(".popup-with-image__figcaption"),T=document.querySelectorAll(".popup"),D={inputErrorClass:"popup__input-field_type_error",errorClass:"popup__input-field-error_active"};T.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&O(t),e.target.classList.contains("popup__close-button")&&O(t)}))}));var N=function(t){document.addEventListener("keydown",F),t.classList.add("popup_opened")},O=function(t){document.removeEventListener("keydown",F),t.classList.remove("popup_opened")},J=function(t){t.reset()},H=function(t){e=t},z=function(t){U.src=t.src,U.alt=t.alt,B.textContent=t.textContent,U.onload=function(){return N(w)}},M=function(){h.value=c.textContent,S.value=u.textContent},F=function(t){"Escape"===t.code&&T.forEach((function(t){t.classList.contains("popup_opened")&&O(t)}))};L.addEventListener("submit",(function(t){var e;t.preventDefault(),j.textContent="Сохранение...",(e={name:b.value,link:q.value},fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(e){p(l(e.name,e.link,[],e._id,e.owner._id),s),J(t.target),o({inactiveButtonClass:"popup__save-button_inactive"},[b,q],j),O(m)})).finally((function(){j.textContent="Создать"}))})),k.addEventListener("submit",(function(t){var e;t.preventDefault(),x.textContent="Сохранение...",x.removeEventListener(),(e={name:h.value,about:S.value},fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(t){return t.ok?e:Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){c.textContent=t.name,u.textContent=t.about,O(f)})).finally((function(){x.textContent="Сохранить"}))})),E.addEventListener("submit",(function(t){var e;t.preventDefault(),A.textContent="Сохранение...",(e=C.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?e:Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(e){i.src=e,J(t.target),o({inactiveButtonClass:"popup__save-button_inactive"},[C],A),O(v)})).finally((function(){A.textContent="Сохранить"}))})),g.addEventListener("submit",(function(t){t.preventDefault(),P.textContent="Удаление...",function(t){var e,n=t.target.closest(".post");return(e=n.id,fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(){n.remove()}))}(e).then((function(){O(y)})).finally((function(){P.textContent="Да"}))}));var G=document.querySelector(".profile__edit-button"),I=document.querySelector(".profile__add-button");fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).then((function(e){c.textContent=e.name,u.textContent=e.about,i.alt=e.name,i.src=e.avatar,t=e._id})),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)})).then((function(t){return t.forEach((function(t){p(l(t.name,t.link,t.likes,t._id,t.owner._id),s)}))})),M(),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){Array.from(e.querySelectorAll(t.fieldsetSelector)).forEach((function(e){!function(t,e){var r=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);o(t,r,c),r.forEach((function(u){u.addEventListener("input",(function(){!function(t,e,o){o.validity.valid?n(t,e,o):function(t,e,n,o){var r=e.querySelector(".".concat(n.id,"-input-error"));n.classList.add(t.inputErrorClass),r.classList.add(t.errorClass),r.textContent=o}(t,e,o,o.validationMessage)}(t,e,u),o(t,r,c)}))}))}(t,e)}))}))}({formSelector:".popup__form",inputSelector:".popup__input-field",fieldsetSelector:".popup__fieldset",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__input-field_type_error",errorClass:"popup__input-field-error_active"}),G.addEventListener("click",(function(){var t;M(),t=k,Array.from(t.querySelectorAll(".popup__input-field")).forEach((function(e){n(D,t,e)})),o({inactiveButtonClass:"popup__save-button_inactive"},[h,S],x),N(f)})),I.addEventListener("click",(function(){N(m)})),i.addEventListener("click",(function(){N(v)})),window.onload=function(){document.querySelector(".page").classList.remove("page_without-transition")}})();